var v=(b,S,E)=>{"use strict";E.d(S,{H4:()=>O,j8:()=>x});var m=E(872),d=E(4329),P=E(2091),$=E(7636);function C(e){let s="";for(let a=0;a<e.length;a++){let n=e.charCodeAt(a);(n>64&&n<91||n>96&&n<123)&&(s+=e[a])}return s}function R(e,s){return e.replace(RegExp(`:${(0,P.f)(s)}`,"g"),`__ESC_COLON_${s}`)}function A(e){return e.replace(/__ESC_COLON_/gi,":")}function O(e,s,a=[],n=[]){let t={},i=o=>{let l,p=o.key;switch(o.type){case"header":p=p.toLowerCase(),l=e.headers[p];break;case"cookie":l=e.cookies[o.key];break;case"query":l=s[p];break;case"host":{let{host:u}=e?.headers||{};l=u?.split(":")[0].toLowerCase()}}if(!o.value&&l)return t[C(p)]=l,!0;if(l){let u=RegExp(`^${o.value}$`),c=Array.isArray(l)?l.slice(-1)[0].match(u):l.match(u);if(c)return Array.isArray(c)&&(c.groups?Object.keys(c.groups).forEach(f=>{t[f]=c.groups[f]}):o.type==="host"&&c[0]&&(t.host=c[0])),!0}return!1};return!!(a.every(o=>i(o))&&!n.some(o=>i(o)))&&t}function g(e,s){if(!e.includes(":"))return e;for(let a of Object.keys(s))e.includes(`:${a}`)&&(e=e.replace(RegExp(`:${a}\\*`,"g"),`:${a}--ESCAPED_PARAM_ASTERISKS`).replace(RegExp(`:${a}\\?`,"g"),`:${a}--ESCAPED_PARAM_QUESTION`).replace(RegExp(`:${a}\\+`,"g"),`:${a}--ESCAPED_PARAM_PLUS`).replace(RegExp(`:${a}(?!\\w)`,"g"),`--ESCAPED_PARAM_COLON${a}`));return e=e.replace(/(:|\*|\?|\+|\(|\)|\{|\})/g,"\\$1").replace(/--ESCAPED_PARAM_PLUS/g,"+").replace(/--ESCAPED_PARAM_COLON/g,":").replace(/--ESCAPED_PARAM_QUESTION/g,"?").replace(/--ESCAPED_PARAM_ASTERISKS/g,"*"),(0,d.MY)(`/${e}`,{validate:!1})(s).slice(1)}function x(e){let s,a=Object.assign({},e.query);delete a.__nextLocale,delete a.__nextDefaultLocale,delete a.__nextDataReq;let n=e.destination;for(let r of Object.keys((0,m.Z)({},e.params,a)))n=R(n,r);let t=(0,$.e)(n),i=t.query,_=A(`${t.pathname}${t.hash||""}`),o=A(t.hostname||""),l=[],p=[];(0,d.Bo)(_,l),(0,d.Bo)(o,p);let u=[];l.forEach(r=>u.push(r.name)),p.forEach(r=>u.push(r.name));let c=(0,d.MY)(_,{validate:!1}),f=(0,d.MY)(o,{validate:!1});for(let[r,h]of Object.entries(i))Array.isArray(h)?i[r]=h.map(k=>g(A(k),e.params)):typeof h=="string"&&(i[r]=g(A(h),e.params));let y=Object.keys(e.params).filter(r=>r!=="nextInternalLocale");if(e.appendParamsToQuery&&!y.some(r=>u.includes(r)))for(let r of y)r in i||(i[r]=e.params[r]);try{s=c(e.params);let[r,h]=s.split("#");t.hostname=f(e.params),t.pathname=r,t.hash=`${h?"#":""}${h||""}`,delete t.search}catch(r){throw r.message.match(/Expected .*? to not repeat, but got an array/)?Error("To use a multi-match in the destination you must add `*` at the end of the param name to signify it should repeat. https://nextjs.org/docs/messages/invalid-multi-match"):r}return t.query=(0,m.Z)({},a,t.query),{newUrl:s,destQuery:i,parsedDestination:t}}};export{v as default};
